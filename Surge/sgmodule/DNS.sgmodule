#!name=防DNS泄漏（允许更新）
#!desc=防止DNS泄漏，同时允许Surge更新外部资源

[General]
dns-server = 8.8.8.8, 1.1.1.1
always-real-ip = *.srv.nintendo.net, *.stun.playstation.net, xbox.*.microsoft.com, *.xboxlive.com, stun.*, global.turn.twilio.com, global.stun.twilio.com, localhost.*.qq.com, localhost.*.weixin.qq.com, *.logon.battlenet.com.cn, *.logon.battle.net, *.blzstatic.cn

[Host]
# 在这里可以添加本地网络的自定义域名解析
# 例如：router.lan = 192.168.1.1

[Rule]
# 允许 Surge 相关域名直连，确保可以更新外部资源
DOMAIN-SUFFIX,nssurge.com,DIRECT

# 仅拦截非 Surge 的常规 DNS 查询
AND,((PROTOCOL,UDP),(DEST-PORT,53),(NOT,((DST-IP,8.8.8.8))),((NOT,((DST-IP,1.1.1.1))))),REJECT-NO-DROP
AND,((PROTOCOL,TCP),(DEST-PORT,53),(NOT,((DST-IP,8.8.8.8))),((NOT,((DST-IP,1.1.1.1))))),REJECT-NO-DROP